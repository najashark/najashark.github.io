---
layout: post
title: "[Writeup] KPMG 2016 - re2 Japan "
date: '2016-11-27T20:28:00.000+08:00'
author: najashark
tags:
- reverse
- '2016'
- kpmg
- ctf
- RE
- kpmgsecuritychallenge2016
modified_time: '2016-12-01T23:45:22.057+08:00'
thumbnail: https://2.bp.blogspot.com/-mPpIZe-i8XY/WDrG03Xnx6I/AAAAAAAAFEQ/QNCdpJZxJgUyf0NmqTtZURiF2IwZPHf1QCLcB/s72-c/0intro.PNG
blogger_id: tag:blogger.com,1999:blog-8076034119619025020.post-1588148511671714747
blogger_orig_url: http://blog.najashark.net/2016/11/writeup-kpmg16-re2-japan.html
---

<div class="separator" style="clear: both; text-align: center;"></div>Here is some explaination on re2_8dbeee84fa0ec05fadda075508c13be0.exe on KPMG Security Challenge 2016. I didn't manage to solve it on the competition day, unlucky me.<br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="https://2.bp.blogspot.com/-mPpIZe-i8XY/WDrG03Xnx6I/AAAAAAAAFEQ/QNCdpJZxJgUyf0NmqTtZURiF2IwZPHf1QCLcB/s1600/0intro.PNG" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="187" src="https://2.bp.blogspot.com/-mPpIZe-i8XY/WDrG03Xnx6I/AAAAAAAAFEQ/QNCdpJZxJgUyf0NmqTtZURiF2IwZPHf1QCLcB/s400/0intro.PNG" width="400" /></a></div>&nbsp;So its packed with UPX, easy right? just unpack it.<br /><div class="separator" style="clear: both; text-align: center;"><a href="https://3.bp.blogspot.com/-N2iSNYHpev0/WDrG3vCiafI/AAAAAAAAFEU/QCYSzhfGbKYA2ZAF5GMDS9vgA6L4_ZYUwCEw/s1600/1upx.PNG" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="72" src="https://3.bp.blogspot.com/-N2iSNYHpev0/WDrG3vCiafI/AAAAAAAAFEU/QCYSzhfGbKYA2ZAF5GMDS9vgA6L4_ZYUwCEw/s400/1upx.PNG" width="400" /></a></div>Ok successfully unpack, no worries. Try run it.<br /><div class="separator" style="clear: both; text-align: center;"><a href="https://1.bp.blogspot.com/-qytPuiOevNc/WDrG3p5HNhI/AAAAAAAAFEY/77nfAIeuhLAy61Zrlc4yH8Zsm9uUC4LWgCLcB/s1600/2crash.PNG" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="232" src="https://1.bp.blogspot.com/-qytPuiOevNc/WDrG3p5HNhI/AAAAAAAAFEY/77nfAIeuhLAy61Zrlc4yH8Zsm9uUC4LWgCLcB/s320/2crash.PNG" width="320" /></a></div>&nbsp;Oh no! stopped working. try load in IDA if we see something in it.<br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="https://3.bp.blogspot.com/-Wfxl7QWIfEE/WDrG4Iphb6I/AAAAAAAAFEg/-nUHpw4Y5ascsw5o73FLC_WxTRKu3KTfQCLcB/s1600/3ida.PNG" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="280" src="https://3.bp.blogspot.com/-Wfxl7QWIfEE/WDrG4Iphb6I/AAAAAAAAFEg/-nUHpw4Y5ascsw5o73FLC_WxTRKu3KTfQCLcB/s400/3ida.PNG" width="400" /></a></div>&nbsp;Looks like we see something like we run the original binary, from here you can get the algo which is compared part by part from memory with our input<br /><div class="separator" style="clear: both; text-align: center;"><a href="https://3.bp.blogspot.com/-4u4PkmysCzA/WDrG4RHwmHI/AAAAAAAAFFE/a_X7lE-cpwA6MoDw3d3ueNMu9rLYIUY1wCEw/s1600/4ida.PNG" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="https://3.bp.blogspot.com/-4u4PkmysCzA/WDrG4RHwmHI/AAAAAAAAFFE/a_X7lE-cpwA6MoDw3d3ueNMu9rLYIUY1wCEw/s1600/4ida.PNG" /></a></div>we can also see that our input is calculated and check to matching 32 char sting, if not you get the sayonara.<br /><br />So the trick is either manual unpacking the upx or attached it to the debugger to get the answer from memory, my way is attaching the binary, run first and attached it.<br /><div class="separator" style="clear: both; text-align: center;"><a href="https://1.bp.blogspot.com/-oFG4c-94Wjg/WDrG41tBDbI/AAAAAAAAFFE/tb-quv0-RSc4-2OzpIe_j3zhRoUvYH-8gCEw/s1600/6input.PNG" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="186" src="https://1.bp.blogspot.com/-oFG4c-94Wjg/WDrG41tBDbI/AAAAAAAAFFE/tb-quv0-RSc4-2OzpIe_j3zhRoUvYH-8gCEw/s640/6input.PNG" width="640" /></a></div>run it and put 32 char string to the input and attach to the debugger and the press enter then observe it in debugger.<br /><div class="separator" style="clear: both; text-align: center;"><a href="https://2.bp.blogspot.com/-Z9eqHRAGvGc/WDrG4twUAFI/AAAAAAAAFEo/h30cIj1Boe02WmhSe4OKNXq_z72rtxmaACLcB/s1600/5attach.PNG" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="212" src="https://2.bp.blogspot.com/-Z9eqHRAGvGc/WDrG4twUAFI/AAAAAAAAFEo/h30cIj1Boe02WmhSe4OKNXq_z72rtxmaACLcB/s640/5attach.PNG" width="640" /></a></div><br /><br />Bear in mind, this binary have several anti-debug trick, like IsDebuggerPresent, just patch it or use plugin.<br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="https://2.bp.blogspot.com/-0pZHvIWgXVA/WDrG5dLL5uI/AAAAAAAAFEw/AiaDstfMY44hmWvNKcndnzxVqnrNazangCLcB/s1600/7step.PNG" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="350" src="https://2.bp.blogspot.com/-0pZHvIWgXVA/WDrG5dLL5uI/AAAAAAAAFEw/AiaDstfMY44hmWvNKcndnzxVqnrNazangCLcB/s640/7step.PNG" width="640" /></a></div>You need to step until you find re2 module like I circle in red, then  you can see the original code, you can dumped the code and rebuild the  PE file or just debug the code.<br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="https://1.bp.blogspot.com/-f0jdwJKgnYw/WDrG5YuHPtI/AAAAAAAAFE0/i-r8DpvIOQEvY21bXZErTavp1bsJ8pUngCLcB/s1600/8cmp.PNG" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="70" src="https://1.bp.blogspot.com/-f0jdwJKgnYw/WDrG5YuHPtI/AAAAAAAAFE0/i-r8DpvIOQEvY21bXZErTavp1bsJ8pUngCLcB/s320/8cmp.PNG" width="320" /></a></div>&nbsp;It compared first 8 char one by one.<br /><div class="separator" style="clear: both; text-align: center;"></div><br /><div class="separator" style="clear: both; text-align: center;"><a href="https://3.bp.blogspot.com/-SklIhRtuKto/WDrG58TXK1I/AAAAAAAAFE8/PzxZwrrHQMEbs4bq9f1eFQT88KAr-myXgCLcB/s1600/9reg.PNG" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="https://3.bp.blogspot.com/-SklIhRtuKto/WDrG58TXK1I/AAAAAAAAFE8/PzxZwrrHQMEbs4bq9f1eFQT88KAr-myXgCLcB/s1600/9reg.PNG" /></a></div>Here we can see the register which compared our first 8 char with first 8char of the flag. Just copy and edit our input to the same one and you good to go for another part of the flag, doing it until you get the whole flag.<br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="https://1.bp.blogspot.com/-7ozueaz4P1c/WDrG5qTu33I/AAAAAAAAFFE/x7hW3W3lA60-z1V1KYalX-JwQdfnhc_KgCEw/s1600/9checkeragain.PNG" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="179" src="https://1.bp.blogspot.com/-7ozueaz4P1c/WDrG5qTu33I/AAAAAAAAFFE/x7hW3W3lA60-z1V1KYalX-JwQdfnhc_KgCEw/s640/9checkeragain.PNG" width="640" /></a></div>The binary check again at the last part to make sure you not edit the input during debug, just skip or edit the input in memory<br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="https://3.bp.blogspot.com/-aMY5y5p6MmQ/WDrG33A8IQI/AAAAAAAAFEc/4N125LIfVqIQ54OrotK9ki0A6RTUFViwQCLcB/s1600/10flag.PNG" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="249" src="https://3.bp.blogspot.com/-aMY5y5p6MmQ/WDrG33A8IQI/AAAAAAAAFEc/4N125LIfVqIQ54OrotK9ki0A6RTUFViwQCLcB/s640/10flag.PNG" width="640" /></a></div>Try it with the whole flag and the you get the flag!<br /><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">Congratulations! It is correct... The flag is KPMG{S`/C&amp;0^X3660rkv,5wJ+Ce@(fa-s*m9f}</span><br /><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;"><i><span style="font-family: Times, &quot;Times New Roman&quot;, serif;">EDIT: Thanks to master jani for pointing out to remove ASLR before doing "upx -d" to prevent crashes after unpacking.</span></i></span>