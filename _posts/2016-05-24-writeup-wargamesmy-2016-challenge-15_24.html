---
layout: post
title: "[Writeup] Wargames.my 2016 - Challenge 15"
date: '2016-05-24T03:47:00.000+08:00'
author: najashark
tags:
- wargames.my
- analysis
- '2016'
- malware
modified_time: '2016-05-24T03:58:07.934+08:00'
thumbnail: https://1.bp.blogspot.com/-NJAsG1n9Rpk/V0Na6bG4YUI/AAAAAAAAE5c/r86lsUoZiD8NTLuozyMVY1FZ1YT4wWi3QCLcB/s72-c/1.PNG
blogger_id: tag:blogger.com,1999:blog-8076034119619025020.post-3948475073222370316
blogger_orig_url: http://blog.najashark.net/2016/05/writeup-wargamesmy-2016-challenge-15_24.html
---

Another frustration, 500 points should been a sweet victory at the end. If I had enough time to play that day.....<br /><br />so we get a zip file which contains this<br /><div class="separator" style="clear: both; text-align: center;"><a href="https://1.bp.blogspot.com/-NJAsG1n9Rpk/V0Na6bG4YUI/AAAAAAAAE5c/r86lsUoZiD8NTLuozyMVY1FZ1YT4wWi3QCLcB/s1600/1.PNG" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="320" src="https://1.bp.blogspot.com/-NJAsG1n9Rpk/V0Na6bG4YUI/AAAAAAAAE5c/r86lsUoZiD8NTLuozyMVY1FZ1YT4wWi3QCLcB/s320/1.PNG" width="131" /></a></div><br />how about we open that README.md which  has something info about this file<br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;"><span style="font-size: x-small;">Mori-Dark<br />=========<br /><br />An HTML5 minimalistic super-responsive portfolio and blog template.<br /><br />CSS-only hexagon hive gallery!<br /><br />http://mori-dark.s3-website.eu-central-1.amazonaws.com/</span></span><br /><br /><span style="font-family: inherit;">open index.html on browser and we get some pr0n stuff<span style="font-family: inherit;">, haha</span></span><br /><br /><div class="separator" style="clear: both; text-align: center;"><span style="font-family: inherit;"><span style="font-family: inherit;"><a href="https://3.bp.blogspot.com/-pPYPNliWmCM/V0NbDCOBvVI/AAAAAAAAE5w/_fWHOlW7gY4QN1FNjxGtGnNHIa7iej7CwCKgB/s1600/2.PNG" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="231" src="https://3.bp.blogspot.com/-pPYPNliWmCM/V0NbDCOBvVI/AAAAAAAAE5w/_fWHOlW7gY4QN1FNjxGtGnNHIa7iej7CwCKgB/s400/2.PNG" width="400" /></a></span></span></div><br /><span style="font-family: inherit;"><span style="font-family: inherit;"><span style="font-family: inherit;">WARNI<span style="font-family: inherit;">NG <span style="font-family: inherit;">HERE! <span style="font-family: inherit;">This write up is a long <span style="font-family: inherit;">step</span> to get the answer</span></span></span>, there is always a short<span style="font-family: inherit;">cut to get the flag <span style="font-family: inherit;">quickly</span></span></span></span></span><br /><br /><span style="font-family: inherit;"><span style="font-family: inherit;"><span style="font-family: inherit;"><span style="font-family: inherit;"><span style="font-family: inherit;">so how a<span style="font-family: inherit;">bout we get the <span style="font-family: inherit;">original template and compare the <span style="font-family: inherit;"><span style="font-family: inherit;">difference</span> between each file</span></span></span></span></span></span></span></span><br /><span style="font-family: inherit;"><span style="font-family: inherit;"><span style="font-family: inherit;"><span style="font-family: inherit;"><span style="font-family: inherit;"><span style="font-family: inherit;"><span style="font-family: inherit;"><span style="font-family: inherit;">and I found som<span style="font-family: inherit;">ething on index.html</span></span></span></span></span></span></span></span></span><br /><div class="separator" style="clear: both; text-align: center;"><a href="https://1.bp.blogspot.com/-ekARGezR1mk/V0Na9j7wmOI/AAAAAAAAE5s/Hvpy9Ht6Gtk0KESIdbYnuoTgI5tkz4u_QCKgB/s1600/3.PNG" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="176" src="https://1.bp.blogspot.com/-ekARGezR1mk/V0Na9j7wmOI/AAAAAAAAE5s/Hvpy9Ht6Gtk0KESIdbYnuoTgI5tkz4u_QCKgB/s400/3.PNG" width="400" /></a></div><br /><span style="font-family: inherit;"><span style="font-family: inherit;"><span style="font-family: inherit;"><span style="font-family: inherit;"><span style="font-family: inherit;"><span style="font-family: inherit;"><span style="font-family: inherit;">because </span>it is javascript, why dont we use <span style="font-family: inherit;">M</span>alzilla to <span style="font-family: inherit;">investi<span style="font-family: inherit;">gate later about this</span><span style="font-family: inherit;">.</span></span></span></span></span></span></span></span><br /><span style="font-family: inherit;"><span style="font-family: inherit;"><span style="font-family: inherit;"><span style="font-family: inherit;"><span style="font-family: inherit;"><span style="font-family: inherit;"><span style="font-family: inherit;"><span style="font-family: inherit;">open up Malzilla and paste the <span style="font-family: inherit;">index.html and <span style="font-family: inherit;">click find object, select object that highlight the shellco<span style="font-family: inherit;">de<span style="font-family: inherit;"> and then double<span style="font-family: inherit;">-click to send to the decoder<span style="font-family: inherit;">.</span></span></span></span></span></span></span></span></span></span></span></span></span></span><br /><br /><div class="separator" style="clear: both; text-align: center;"><span style="font-family: inherit;"><span style="font-family: inherit;"><span style="font-family: inherit;"><a href="https://2.bp.blogspot.com/-LpAMfRO9vZk/V0NbEPiBU7I/AAAAAAAAE50/MMENyGeTK_8IiDNXABoIlF6iaRa_uwOSQCKgB/s1600/4.PNG" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="133" src="https://2.bp.blogspot.com/-LpAMfRO9vZk/V0NbEPiBU7I/AAAAAAAAE50/MMENyGeTK_8IiDNXABoIlF6iaRa_uwOSQCKgB/s400/4.PNG" width="400" />&nbsp;</a></span></span></span></div><div class="separator" style="clear: both; text-align: center;"><span style="font-family: inherit;"><span style="font-family: inherit;"><span style="font-family: inherit;"><a href="https://3.bp.blogspot.com/-UEnGjP1REo4/V0NbEhWfh7I/AAAAAAAAE54/zuWmQ4s3n_kI0Ien2Yrg22DEEy03dep-ACKgB/s1600/5.PNG" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="210" src="https://3.bp.blogspot.com/-UEnGjP1REo4/V0NbEhWfh7I/AAAAAAAAE54/zuWmQ4s3n_kI0Ien2Yrg22DEEy03dep-ACKgB/s400/5.PNG" width="400" /></a></span></span></span></div><br /><span style="font-family: inherit;"><span style="font-family: inherit;"><span style="font-family: inherit;"><span style="font-family: inherit;"><span style="font-family: inherit;"><span style="font-family: inherit;"><span style="font-family: inherit;"><span style="font-family: inherit;"><span style="font-family: inherit;"><span style="font-family: inherit;"><span style="font-family: inherit;"><span style="font-family: inherit;">At decoder I use override eval() to get the unescape script first</span></span></span></span></span></span></span></span></span></span></span></span><br /><span style="font-family: inherit;"><span style="font-family: inherit;"><span style="font-family: inherit;"><span style="font-family: inherit;"><span style="font-family: inherit;"><span style="font-family: inherit;"><span style="font-family: inherit;"><span style="font-family: inherit;"><span style="font-family: inherit;"><span style="font-family: inherit;"><span style="font-family: inherit;"><span style="font-family: inherit;">then we can de<span style="font-family: inherit;">code the unescape <span style="font-family: inherit;">by using document write like this, and try run on malzilla and we get some gibberish, but is it?</span></span></span></span></span></span></span></span></span></span></span></span></span></span><br /><span style="font-family: inherit;"><span style="font-family: inherit;"><span style="font-family: inherit;"><span style="font-family: inherit;"><span style="font-family: inherit;"><span style="font-family: inherit;"><span style="font-family: inherit;"><span style="font-family: inherit;"><span style="font-family: inherit;"><span style="font-family: inherit;"><span style="font-family: inherit;"><span style="font-family: inherit;"><span style="font-family: inherit;"><span style="font-family: inherit;"></span></span></span></span></span></span></span></span></span></span></span></span></span></span><br /><br /><div class="separator" style="clear: both; text-align: center;"><span style="font-family: inherit;"><span style="font-family: inherit;"><span style="font-family: inherit;"><a href="https://4.bp.blogspot.com/-g6iVUMBvF94/V0NbEmTIh_I/AAAAAAAAE58/iN0BrNPxBAobYR_mFSqM-Qk5QKnYWRa7wCKgB/s1600/6.PNG" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="34" src="https://4.bp.blogspot.com/-g6iVUMBvF94/V0NbEmTIh_I/AAAAAAAAE58/iN0BrNPxBAobYR_mFSqM-Qk5QKnYWRa7wCKgB/s320/6.PNG" width="320" />&nbsp;</a></span></span></span></div><div class="separator" style="clear: both; text-align: center;"><span style="font-family: inherit;"><span style="font-family: inherit;"><span style="font-family: inherit;"><a href="https://3.bp.blogspot.com/-QhefA37cvN0/V0NbFjs5RkI/AAAAAAAAE6Q/jhyXS9LlA4wzlsqOiNSvzk_2o3fIL7puwCKgB/s1600/7.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="320" src="https://3.bp.blogspot.com/-QhefA37cvN0/V0NbFjs5RkI/AAAAAAAAE6Q/jhyXS9LlA4wzlsqOiNSvzk_2o3fIL7puwCKgB/s400/7.png" width="400" /></a></span></span></span></div><br /><span style="font-family: inherit;"><span style="font-family: inherit;"><span style="font-family: inherit;"><span style="font-family: inherit;"><span style="font-family: inherit;"><span style="font-family: inherit;"><span style="font-family: inherit;"><span style="font-family: inherit;"><span style="font-family: inherit;"><span style="font-family: inherit;"><span style="font-family: inherit;"><span style="font-family: inherit;"><span style="font-family: inherit;"><span style="font-family: inherit;">some goo<span style="font-family: inherit;">gle<span style="font-family: inherit;">-fu</span></span> I found out th<span style="font-family: inherit;">at the string <span style="font-family: inherit;">was vbscript.encode using to<span style="font-family: inherit;">ols called</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> </span>screnc<br />and it can be decoded, so we save the encoded text to file and decode using scrdec.exe<br /><br />scrdec.exe encoded.vbe decoded.vbs<br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="https://4.bp.blogspot.com/-8hIFDiLD1lk/V0NbGkigZMI/AAAAAAAAE6Q/ILN5meez7-kyY7ZYGYoDePJrQlBcpNKDACKgB/s1600/8.PNG" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="112" src="https://4.bp.blogspot.com/-8hIFDiLD1lk/V0NbGkigZMI/AAAAAAAAE6Q/ILN5meez7-kyY7ZYGYoDePJrQlBcpNKDACKgB/s400/8.PNG" width="400" /></a></div>and we get the decoded sourcecode. It looks like a dropper, so we take the long hex string and paste to hex editor and we can see the MZ header, so it is a PE file. Also I noticed some UPX header in the file.<br /><div class="separator" style="clear: both; text-align: center;"><a href="https://1.bp.blogspot.com/-hdEJ0gk1ViQ/V0NbGg-M9bI/AAAAAAAAE6Q/mvBLwJvcukQ6M2whDWuYI3YIkojVhYQFACKgB/s1600/9.PNG" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="400" src="https://1.bp.blogspot.com/-hdEJ0gk1ViQ/V0NbGg-M9bI/AAAAAAAAE6Q/mvBLwJvcukQ6M2whDWuYI3YIkojVhYQFACKgB/s400/9.PNG" width="361" /></a></div><br />Try running it, we get a warning by Nafiez. I lol'ed at this<br /><div class="separator" style="clear: both; text-align: center;"><a href="https://3.bp.blogspot.com/-DKpvoXX5q-w/V0Na6WqFUXI/AAAAAAAAE6Q/QhuihAUUqbMfA1AHJGgV8je5z2J9pnVvQCKgB/s1600/10.PNG" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="138" src="https://3.bp.blogspot.com/-DKpvoXX5q-w/V0Na6WqFUXI/AAAAAAAAE6Q/QhuihAUUqbMfA1AHJGgV8je5z2J9pnVvQCKgB/s320/10.PNG" width="320" /></a></div><br />Unpack it with upx -d get something strange. Then I remembered flare-on challenge last year, that implemented this. <a href="https://www.aldeid.com/wiki/The-FLARE-On-Challenge-2015/Challenge-4" rel="nofollow">more here</a><br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="https://4.bp.blogspot.com/-6PQuDeTErS4/V0Na6ZZkSGI/AAAAAAAAE6Q/47xqFJmxK3w95Kk6X1N4_d3ApEn3DISAgCKgB/s1600/11.PNG" imageanchor="1"><img border="0" height="182" src="https://4.bp.blogspot.com/-6PQuDeTErS4/V0Na6ZZkSGI/AAAAAAAAE6Q/47xqFJmxK3w95Kk6X1N4_d3ApEn3DISAgCKgB/s1600/11.PNG" width="320" /></a></div>so we just debug the file without upx -d it.<br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="https://1.bp.blogspot.com/-egOVPNMF5QQ/V0Na7j1kgdI/AAAAAAAAE6Q/3Hm3etmhJ-EG1KaLKBrkpGg2GbqWykICwCKgB/s1600/12.PNG" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="288" src="https://1.bp.blogspot.com/-egOVPNMF5QQ/V0Na7j1kgdI/AAAAAAAAE6Q/3Hm3etmhJ-EG1KaLKBrkpGg2GbqWykICwCKgB/s640/12.PNG" width="640" /></a></div>try running it and we get the bendera!<span style="font-family: inherit;"> but I didn't get the chance to verified it<span style="font-family: inherit;">, hope the flag is correct.</span></span><br /><div class="separator" style="clear: both; text-align: center;"><a href="https://2.bp.blogspot.com/-FO4sscSl7SU/V0NdX_aH-jI/AAAAAAAAE6U/n3r-30lccBExJIlfRJbOpaCtobzeeVBswCLcB/s1600/13.PNG" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="224" src="https://2.bp.blogspot.com/-FO4sscSl7SU/V0NdX_aH-jI/AAAAAAAAE6U/n3r-30lccBExJIlfRJbOpaCtobzeeVBswCLcB/s320/13.PNG" width="320" /></a></div><br />flag: nafiezawesome<br /><br /><i>*yup this guys awesome,I have met him twice i think and this is the first time I completely answered his question. I still remembered pandame.exe....</i><br /><br /><a href="https://www.blogger.com/blogger.g?blogID=8076034119619025020" imageanchor="1" style="clear: right; float: right; margin-bottom: 1em; margin-left: 1em;"></a>nice challenge, which I learn how to use new tools like srcdec and malzilla but still frustrating coz cannot solve on that day. 